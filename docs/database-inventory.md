# ğŸ“Š Supabase Database Inventory (2025-04-15)

This document provides a comprehensive overview of the current Supabase database schema, including tables, columns, relationships, indexes, and Row Level Security (RLS) status. Use this as a source of truth for architecture, onboarding, and refactoring.

---

## ğŸ—‚ï¸ Schemas

- **public**: Main business data
- **auth**: Authentication and user management
- **storage**: File storage
- **extensions**: Custom/third-party extensions
- **graphql**: GraphQL API support
- **pgsodium, vault**: Encryption, secrets management

---

## ğŸ“‹ Table Inventory (Sample)

### auth.audit_log_entries

- **Purpose:** Audit trail for user actions
- **Columns:**
  - `instance_id` (uuid, nullable)
  - `id` (uuid, primary key)
  - `payload` (json, nullable)
  - `created_at` (timestamptz, nullable)
  - `ip_address` (varchar, not null, default '')
- **RLS:** Enabled
- **Indexes:** PK on `id`

### public.analytics_events

- **Purpose:** Stores analytics events for user interactions
- **Columns:**
  - `id` (uuid, PK)
  - `user_id` (uuid, FK to auth.users)
  - `event_type` (text)
  - `event_data` (jsonb, nullable)
  - `created_at` (timestamptz, default now())
- **RLS:** [RECOMMEND: Enable if not already]
- **Indexes:** PK on `id`, FK on `user_id`

### public.metrics

- **Purpose:** Platform metrics (DAU, MAU, retention, ARPU, NPS, etc.)
- **Columns:**
  - `id` (uuid, PK)
  - `metric_type` (text)
  - `value` (numeric)
  - `recorded_at` (timestamptz)
- **RLS:** [RECOMMEND: Enable]
- **Indexes:**
  - idx_metrics_metric_type (metric_type)
  - idx_metrics_recorded_at (recorded_at)
  - idx_metrics_type_recorded_at (metric_type, recorded_at)

### public.tokens

- **Purpose:** Token economy core
- **Columns:** [See migrations for full details]
- **RLS:** [RECOMMEND: Enable]
- **Indexes:** PK, FKs, business indexes

### ... (many more tables: onboarding, feedback, notifications, admin, roles, etc.)

---

## ğŸ”’ RLS Audit & Recommendations

- **RLS is enabled** on sensitive tables (e.g., audit_log_entries).
- **RECOMMEND:** Enable RLS and write granular, role-based policies for all `public` tables, especially those storing user data or tokens.
- **Document** all policies with rationale.

---

## ğŸ”— Relationships

- **Foreign keys** are used for user references, tokens, analytics, etc.
- **RECOMMEND:** Document all relationships and ensure indexes exist for join performance.

---

## ğŸ§¹ Legacy/Unused Artifacts

- **RECOMMEND:** Review for tables/columns/functions not referenced in codebase or migrations. Remove or archive if not needed.

---

## ğŸ“ Documentation & Comments

- **RECOMMEND:** Add/expand comments for every table, column, and function, describing business purpose and usage.

---

## ğŸ“ˆ ERD Generation

- Use Supabase Studio or tools like dbdiagram.io for a visual ERD.
- Keep ERD updated in `/docs/` for onboarding and architecture reviews.

---

## ğŸš¦ Next Steps

1. Enable and document RLS on all sensitive tables.
2. Expand this inventory with full column and index details for all tables.
3. Generate and maintain an ERD.
4. Align codebase interfaces/services with this schema.
5. Remove or archive legacy artifacts.

---

_Generated by Cascade AI on 2025-04-15_
